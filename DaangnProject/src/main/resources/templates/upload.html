<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8" />
	<title>Document</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	
	<style type="text/css">
		#wrap{width: 800px; margin: 0 auto;}
	</style>
</head>
<body>
	<div id="wrap">
		<h2>물품 올리기</h2>
		<form action="/uploadOk" method="post" enctype="multipart/form-data">
			<!-- /*
				여기서 드래그엔 드롭으로 사진을 넣을수 있게 하겠다.!
				<input type="file" name="file" > <br />
				<input type="file" name="file" > <br />
				<input type="file" name="file" > <br />
				<input type="file" name="file" > <br />
			*/ -->
			<br /><br />
			<p>제목</p>
			<input type="text" id="subject" value="제목">
			<p>가격</p>
			<input type="text" id="price" value="가격을 입력해주세요.">
			<p>자세한 설명</p>
			<textarea id="content" name="content" rows="" cols="" placeholder="ㅁㅁ동(위치값으로 동을 읽어보자!)에 올릴 게시글 내용을 작성해 주세요."></textarea>
			<p>거래희망장소</p>
			<div id="map" style="width:500px;height:400px;"></div>
			<input type="submit" id="homeBtn" value="Home으로" class="btn btn-sm btn-outline-danger">
		</form>
	</div>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=fa04a00338cccad468f169754f5e7cc6"></script>
	<script type="text/javascript">
		$(function(){
			// 위도 경도를 구하는 함수
			navigator.geolocation.getCurrentPosition((position) => {
				let latitude = position.coords.latitude;
				let longitude = position.coords.longitude;
				// 카카오 맵 api 사용
				var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
			    mapOption = { 
			        center: new kakao.maps.LatLng(latitude, longitude), // 지도의 중심좌표
			        level: 3 // 지도의 확대 레벨
			    };
			
				var map = new kakao.maps.Map(mapContainer, mapOption);
				
				
				// 컨트롤러 설정!
				var mapTypeControl = new kakao.maps.MapTypeControl();
				map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
				var zoomControl = new kakao.maps.ZoomControl();
				map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
				var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
				
				// 마커를 담은 배열
				var markers = [];
				// 마커 하나를 지도위에 표시합니다 
				addMarker(new kakao.maps.LatLng(latitude, longitude));
				function addMarker(position) {
				    // 마커를 생성합니다
				    var marker = new kakao.maps.Marker({
				        position: position
				    });
				    // 마커가 지도 위에 표시되도록 설정합니다
				    marker.setMap(map);
				    // 생성된 마커를 배열에 추가합니다
				    markers.push(marker);
				}
				function setMarkers(map) {
				    for (var i = 0; i < markers.length; i++) {
				        markers[i].setMap(null);
				    }            
				}
				var markerPosition  = new kakao.maps.LatLng(latitude, longitude); 
				
				// 마우스 드래그로 지도 이동이 완료되었을 때 마지막 파라미터로 넘어온 함수를 호출하도록 이벤트를 등록합니다
				kakao.maps.event.addListener(map, 'center_changed', function() {
					// 마커 모두 지우기
					setMarkers(map)
				    // 지도 중심좌표를 얻어옵니다 
				    var latlng = map.getCenter();
					// 마커찍기
					addMarker(new kakao.maps.LatLng(latlng.getLat(), latlng.getLng()));
				});
				
			});
		});
	</script>
</body>
</html>