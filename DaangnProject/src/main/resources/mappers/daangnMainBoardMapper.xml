<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" "./mybatis-3-mapper.dtd" >
<mapper namespace="kr.ezen.daangn.dao.DaangnMainBoardDAO">
	
	<!-- 조회하기 페이징처리및 서치도 가능하게 -->
	<select id="selectList" parameterType="CommonVO" resultType="DaangnMainBoardVO">
		select
			*
		from
			daangn_board
		<where>
	        <trim prefix="AND" suffixOverrides="AND">
	            <if test="region != null">
	                LOC LIKE '%' || #{region} || '%' AND
	            </if>
	            <if test="gu != null">
	                LOC LIKE '%' || #{gu} || '%' AND
	            </if>
	            <if test="dong != null">
	                LOC LIKE '%' || #{dong} || '%' AND
	            </if>
	            <if test="search != null">
	                (
	                    SUBJECT LIKE '%' || #{search} || '%'
	                    OR CONTENT LIKE '%' || #{search} || '%'
	                )
	                AND
	            </if>
	        </trim>
   		</where>
			order by
				idx desc
	</select>
	
	<!-- 한개 얻기 -->
	<select id="selectByIdx" parameterType="int" resultType="DaangnMainBoardVO">
		SELECT
		    b.*,
		    c.categoryName,
		    s.statusName
		FROM
		    daangn_board b
		JOIN
		    daangn_category c ON b.categoryRef = c.categoryIdx
		JOIN
		    daangn_status s ON b.statusRef = s.statusIdx
		WHERE
		    b.idx = #{idx}
	</select>
	
	<!-- 유저가쓴글 보기 -->
	<select id="selectByRef" parameterType="int" resultType="DaangnMainBoardVO">
		select * from daangn_board where userRef = #{userRef}
	</select>
	
	<insert id="insert" parameterType="DaangnMainBoardVO">
		<selectKey keyColumn="idx" keyProperty="idx" resultType="int" order="BEFORE">
			select daangn_board_idx_seq.nextval from dual
		</selectKey>
		insert into
			daangn_board
		values
			(
				#{idx, jdbcType=INTEGER}
				, #{userRef}
				, #{categoryRef}
				, 1
				, #{subject}
				, #{content}
				, #{price}
				, #{latitude}
				, #{longitude}
				, #{location}
				, #{loc}
				, 0
				, sysdate
			)
	</insert>
</mapper>